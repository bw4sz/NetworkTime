---
title: Niche overlap decreases with increasing resource availability in a tropical
  plant-pollinator network.
author: "Ben Weinstein"
date: "Tuesday, October 14, 2014"
output:
  html_document:
    theme: spacelab
  word_document: default
---

```{r,echo=FALSE,warning=FALSE,message=FALSE}
require(knitr)
require(reshape2)
require(ggplot2)
library(scales)
library(dplyr)
library(stringr)
require(picante)
require(igraph)
require(bipartite)
library(chron)

#Set Dropbox Location
#setwd to dropbox
droppath<-"C:/Users/Ben/Dropbox/"

#Set github path
gitpath<-"C:/Users/Ben/Documents/NetworkTime/"

setwd(gitpath)

opts_chunk$set(message=FALSE,warning=FALSE,fig.width=13,echo=FALSE,cache=TRUE,cache.path = 'NetworkTime_cache/', fig.path='figure/')
```

#Introduction

* Changing climates will alter ecological communities by reshaping the timing of species interactions. These interactions include pollination ecosystem services that depend on the synchrony of plant flowering and animal pollinators in space and time (Schleuning et al. 2014). 

*	The tightness and fidelity of these interactions are shaped by evolutionary forces promoting specialization and generalization (Vázquez et al. 2009).
  
  * Generalist interactions are likely to be more robust to climatic changes and maintain ecosystem services (Lever et al. 2014).

*The dominant theory for pollinator niche breadth posits that selection should promote adaptations for the most effective pollinator (Stebbins 19XX). 

*	In hummingbirds tradeoffs are manifested in morphological traits, where tend to forage on corollas that match their bill length (Stiles et al. 1978; Vizentin-bugoni et al. 2014). Mismatches in bill morphology reduce foraging efficiency, creating a tradeoff between specialized morphology and niche breadth (Maglianesi et al. 2014). 

*	However, this hypothesis ignores how a pollinator interacts with the surrounding biotic environment and assumes that fitness costs based on morphological tradeoffs are constant throughout the year (Thomson 2003).
  
  *	In nature, biotic interactions occur against a shifting background of resource availability (Petanidou et al. 2008). In the tropical cloud forest, flower availability changes drastically throughout the year (Stiles 1975).

* In addition many specialist show temporal change in feeding behavior.
  *This is well known in cichlid fishes, where the cranial morphology suggest highly specialized behavior, but observation often show wide niche breadth. Wilson (1998) suggested that the cichlid undermine the assumption of tradeoffs in foraging efficiency where the presence of abundant easy to use resources come at no cost for morphological specialization.

*	In this work we evaluate two hypothesis for hummingbird foraging behavior based on optimal foraging theory and competition theory. 
  
  *In our study nectar is the non-equilibirial resource with niche breadth measured as the diversity of plants visited and specialization the diversity of plants visited versus the number of available plants.

* In light of this variation in resource abundance, we test two opposing theories exist for how pollinators should choose potential nectar resources.

##Niche Overlap should increase as available resources increases (‘Optimal Foraging’)

* When there are an abundance of available resources, species do not suffer energy loss from exploitative competition. Local patches are resource rich and difficult to exhaust before nectar replenishes. Species reduce time spent between patches as they minimize foraging for their specialized resource and choose more general resources.

##Niche Overlap should decrease as available resources increases (‘Competition’)
* Stable coexistence of competing species is achieved through niche differentiation that reduces overlap among competitors. During periods of relative food scarcity, animals are expected to adjust feeding to reduce niche overlap with competitors.

  * MacArthur and Levins 1967, Abrams 1983), and niche partitioning (sensu MacArthur 1958, Pianka 1974, 1976, Schoener 1974) 

*	At times of low resource availability species cannot be choosy, and must forage on whatever plants are available. When resource availability is high, species could reduce interspecific competition by eliminating potential competitors. 

##Trait-Matching and Niche Overlap
The above hypothesis predict a pattern of niche overlap and resources, but provide no direct mechanism by which species choose resources. It has been repeated suggested that hummingbird foodplant specialization is mediated through bill-corolla phenotype matching (Feinsinger and Colwell 1978). We therefore expect that as specialization increase, the strength of phenotypic matching should decrease. When given a choice, species should pick the flowers which reduce competition and closely match their bill morphology.

#Methods
###	Data Collection
  
  *Data were collected at the Maquipucuna Research Station and Santa Lucia Ecolodge, Ecuador (0.118 S,-78.612 W) between June and August 2013 along an elevation gradient from 1300 m to 2500 m. The area contains regenerating secondary and primary cloud-forest, and has a warmer dry season from June to September (Webster and Rhodes 2005).
  
  * To measure available resources, we counted the number of hummingbird pollinated plants within 5 m of pre-established trails along six 1 km transects. Each transect covered approximately 200 m of elevation change. For each plant, we estimated the number of total flowers by taking the average number of flowers on 3-5 stalks and multiplying this value by the total number of stalks on a plant. Surveys were repeated two times a month. All hummingbirds visiting flowers were noted during these transects and tagged with a GPS point. 

* In addition, we used time-lapse cameras to monitor hummingbird visitation. Flowers in bloom were noted during each transect, and cameras were placed 1-3 meters from focal flowers. Cameras turned on automatically at dawn and recorded an image every second for at least two days. 

*We used the computer vision program MotionMeerkat to identify images where hummingbirds were observed (Weinstein 2014).

##Network Analysis

###Measures of niche overlap

*Niche Overlap

*Connectance

*Clustering
  *	Why was each measure chosen?

*	Null models
  *	To address sampling constraints (Blüthgen 2010)
  * Randomization Methods


************
**Figure 1. Conceptual figure showing patterns of interactions between birds and flowers for high and low niche overlap, connectance and clustering. The bottom panel shows two hypothezied relationship between available resources, specialization, and trait matching.**

![ConceptualFigure](C:\Users\Ben\Documents\NetworkTime\Figures\ConceptualFigure.png)

************

**Figure 2. Flower abundance per month for each transect. **

```{r}
#Get flower transect data
full.fl<-read.csv("C:/Users/Ben/Dropbox/Thesis/Maquipucuna_SantaLucia/Results/FlowerTransects/FlowerTransectClean.csv",row.names=1)

 #month should be capital 
colnames(full.fl)[colnames(full.fl) %in% "month"]<-"Month"

#group by month and replicate, remove date errors by making a max of 10 flowers, couple times where the gps places it in wrong transect by 1 to 2 meters. 
flower.month<-group_by(full.fl,Month,Year,Transect_R,Date_F) %>% dplyr::summarise(Flowers=sum(Total_Flowers,na.rm=TRUE))  %>% filter(Flowers>50)
  
#Make month abbreviation column, with the right order
flower.month$Month.a<-factor(month.abb[flower.month$Month],month.abb[c(1:12)])

#Make year factor column
flower.month$Year<-as.factor(flower.month$Year)

#Flowers at each elevation over time without Karen's data
ggplot(flower.month,aes(x=Month.a,log(Flowers),shape=as.factor(Year))) + geom_point(size=3) + theme_bw()  + geom_smooth(aes(group=1)) + ylab("Flowers") + xlab("Month") + facet_wrap(~Transect_R,scales="free_y") + labs(shape="Year", y= "Log Available Flowers") + scale_x_discrete(breaks=month.abb[seq(1,12,2)])
ggsave("Figures/AvailableFlowers.jpg",dpi=600,units="in",width=11,height=7)
```

************

```{r network,fig.height=15}
#Compute network measures
#source("Network.R")
```



**Figure 3. Measures of hummingbird plant interactions through time (points) as compared to a null model maintaining the number of observations (shaded region).The size of the point is proportional to the number of interactions measured for each month.**

```{r,fig.width=14}
#Goal to create randomized networks for each month and redo the entire analysis

int<-read.csv(paste(droppath,"Thesis/Maquipucuna_SantaLucia/Results/Network/HummingbirdInteractions.csv",sep=""),row.names=1)
int$Year<-years(int$DateP)
int$Year[int$Year %in% 2012]<-2013

int[int$Year %in% 2013 & int$Month %in% 1,"Year"]<-2014

#break up network by month
int.M<-split(int,list(int$Month,int$Year),drop=TRUE)

#design null function
nullC<-function(x){
  x<-droplevels(x)
  N=nrow(x)
  month.inter<-t(table(x$Hummingbird,x$Iplant_Double))
  month.interB<-(month.inter>0)*1
  true_stat<-networklevel(month.interB,c("connectance","cluster coefficient","niche overlap"))[c(1,3,5)]
  
true_stat<-melt(true_stat)

true_stat$variable<-rownames(true_stat)

# Create 199 random matrixes
r.int<-permatfull(month.inter,times=200)

#compute connectance and clustering on each

#Create a function that computes network metrics
null_total<-as.data.frame(
  t(sapply(r.int$perm,function(x){
#Compute netowkr statistics
out<-networklevel(x,c("connectance","cluster coefficient","niche overlap"))[c(1,3,5)]
return(out)}))
)

#get the upper and lower 2.5th quantiles
nullq<-melt(apply(null_total,2,quantile,c(.025,.975)))

#add month
nullq$Month<-unique(x$Month)

#add Year
nullq$Year<-unique(x$Year)

colnames(nullq)<-c("Quantile","Metric","value","Month","Year")

#cast into desired format
castq<-dcast(nullq,Year+Month+Metric~Quantile)

#append true information
out<-merge(castq,true_stat,by.x="Metric",by.y="variable")
colnames(out)[colnames(out) %in% "value"]<-"True"
out$N<-N
return(out)}

#apply function to each month
dat<-rbind_all(lapply(int.M,nullC))

#name the column of the percentages
colnames(dat)[4]<-"Lower"
colnames(dat)[5]<-"Upper"

#format date
dat$Date<-as.Date(paste(1,dat$Month,dat$Year,sep="/"),format="%d/%m/%Y")

#plot distribution of  values
p<-ggplot(dat,aes(x=Date,fill=Metric)) + geom_point(aes(size=N,y=True)) + geom_line(aes(y=True)) 
p<-p + geom_ribbon(aes(ymin=Lower,ymax=Upper),alpha=.4)+ facet_wrap(~Metric,nrow=1,scales="free") + theme_bw() 
p<-p+scale_fill_discrete(guide="none") + scale_x_date(breaks="3 months",label=date_format("%m/%y")) + scale_size_continuous(range=c(2.5,5),"Observations") + labs(y="")
print(p) 

ggsave("Figures/NullNetwork.jpg",dpi=600,quality=100,pointsize=14,height=4.5,width=12)
```

********

**Figure 4. Connectance, clustering and niche overlap as a function of available resources. Point size is proportional to number of interactions observed that month.**

```{r,fig.height=5,fig.width=12}
    
#get average for each month
flowerMean<-group_by(flower.month,Month,Year,Transect_R) %>% summarize(mFlowers=mean(Flowers,na.rm=TRUE)) %>% group_by(Month,Year) %>% summarize(Flowers=sum(mFlowers,na.rm=TRUE))
  
#combine the flower totals and network metrics
  network.fl<-merge(flowerMean,dat,by=c("Month","Year"))
  
  #Quick visualization 
  p<-ggplot(network.fl[,],aes(log(Flowers),y=True,shape=as.factor(Year))) + geom_point(aes(size=N)) + facet_wrap(~Metric,scale="free")  + geom_smooth(aes(group=1),method="lm") + theme_bw() + labs(col="Month",shape="Year",size="Interactions") + geom_text(aes(label=month.abb[Month]),hjust=-0.25,size=3) + scale_size_continuous(range=c(2.5,5),"Observations") + labs(x="Log Available Resources") + ylab("Score")
  print(p) 
ggsave("Figures/Network_Resources.jpg",height=4,width=10,dpi=300,units="in")
```

## Figure 5. Trait matching

I'm not sure which of the following figures best show what i believe is happenning. The essential idea is:

* Hummingbirds in general match the corolla resources based on their bill length.

* This relationship changes over time

* During periods of high resource availability, trait matching is decreased. This is most pronounced in long billed species.

```{r,fig.width=9,fig.height=7,fig.align='center'}

#read in flower morphology data, comes from Nectar.R
fl.morph<-read.csv(paste(droppath,"Thesis/Maquipucuna_SantaLucia/Results/FlowerMorphology.csv",sep=""))

#First row is empty
fl.morph<-fl.morph[-1,]

#Bring in Hummingbird Morphology Dataset, comes from
hum.morph<-read.csv(paste(droppath,"Thesis/Maquipucuna_SantaLucia/Results/HummingbirdMorphology.csv",sep=""))

#Bring in Interaction Matrix from the Network.R script
int<-read.csv(paste(droppath,"Thesis/Maquipucuna_SantaLucia/Results/Network/HummingbirdInteractions.csv",sep=""),row.names=1)

#Melt the interaction frame and match it with the traits
m.dat<-int[colnames(int) %in% c("ID","Video","Time","Hummingbird","Sex","TransectID","Transect_R","Iplant_Double","Pierce","DateP","Month","ele")]

m.dat$Year<-years(as.Date(m.dat$DateP))
#Fix spacing to match clades

#Which are matching
levels(m.dat$Hummingbird)[!levels(m.dat$Hummingbird) %in% hum.morph$English]

#This needs to be checked
#print(paste(levels(m.dat$Hummingbird)[!levels(m.dat$Hummingbird) %in% hum.morph$English],"not matched"))

#levels(m.dat$Hummingbird)[!levels(m.dat$Hummingbird) %in% hum.morph$English]<-c("Green-crowned Woodnymph")
m.datH<-merge(m.dat,hum.morph, by.x="Hummingbird",by.y="English")

#Merge to flowers
int.FLlevels<-levels(factor(m.datH$Iplant_Double))

#Which flowers are we missing info for?
missingTraits<-int.FLlevels[!int.FLlevels %in% fl.morph$X]

print(paste("Missing Trait Information:",missingTraits))
m.datH<-merge(m.datH,fl.morph, by.x="Iplant_Double",by.y="X")

#Drop piercing events, since they don't represent correlation
m.datH<-m.datH[!m.datH$Pierce %in% c("y","Y"),]
```

###Potential Figure

The correlation coefficient among bill and corolla lengths decreases as a function of available resources. The gray ribbon is a null randomization of the correlation structure for each month.

```{r}
#Time Cycles in correlation between bills and corollas

#Start by plotting monthly breaks of corolla matching

p<-ggplot(m.datH[!is.na(m.datH$Month),],aes(x=factor(Total_Culmen),TotalCorolla,col=Hummingbird)) + geom_point() 
p<-p + geom_smooth(aes(group=1),method="lm") + facet_wrap(~Month) + theme_bw()

p<-ggplot(m.datH[!is.na(m.datH$Month),],aes(x=Total_Culmen,TotalCorolla,col=Month)) + geom_point() 
p<-p + geom_smooth(aes(group=Month),method="lm") + theme_bw() + scale_color_continuous(low="blue",high="red")

#Difference Between Corolla and Bill Length of interactions measured
m.datH$BD<-m.datH$Total_Culmen-m.datH$TotalCorolla
p<-ggplot(m.datH,aes(y=BD,x=Hummingbird)) + geom_boxplot(position="dodge")
p<-p + coord_flip()

#######################################
#Compared usage to available resources
#######################################

sdat<-split(m.datH,list(m.datH$Month,m.datH$Year))

#atleast 30 observations
sdat<-sdat[sapply(sdat,nrow)>30]

######Correlation coefficient
#calculate it for all birds, then short and longbilled (30cm)
coeff<-rbind_all(lapply(sdat,function(x){
  mod.c<-cor(x$Total_Culmen,x$TotalCorolla)

  data.frame(Month=unique(x$Month),Year=as.numeric(as.character(unique(x$Year))),all=mod.c)
}))

#observed correlation
observed<-melt(coeff,measure.vars=c("all"))

#view observed and add date column, just call it the firt of the month for plotting
observed$Date<-as.Date(paste(observed$Month,1,observed$Year,sep="/"),format="%m/%d/%Y")
p<-ggplot(data=observed,aes(x=Date,y=value)) + geom_point() + geom_smooth(aes(group=variable)) 
p<-p+ theme_bw()  + labs(y="Correlation between Bill and Corolla Length",x="Available Resources") + labs(shape="Year")
p
ggsave("Figures/CorrelationTime.jpg",height=5,width=8,units="in",dpi=600)
setwd(gitpath)
```

```{r,fig.height=8}

#Randomization of correlation

#Define replication function, shuffle corolla length values
shufflecor<-function(x){
  #sample draw
  x$NewCorolla<-sample(x$TotalCorolla,replace=F)
  splitdat<-split(x,list(x$Month,x$Year))
  
  #atleast 20 observations
  splitdat<-splitdat[sapply(splitdat,nrow)>20]
  
  ######Correlation coefficient, which method to use?
  coef<-lapply(splitdat,function(y){
    mc<-cor(y$Total_Culmen,y$NewCorolla)
    
    out<-data.frame(Month=unique(y$Month),Year=as.numeric(as.character(unique(y$Year))),all=mc)
    return(out)}
    )
  nullc<-rbind_all(coef)
  return(nullc)
  }

nullcor<-replicate(100,shufflecor(m.datH),simplify = F)
nullcor<-rbind_all(nullcor)
#bind with resource dataframe
nullcor<-merge(flowerMean,nullcor,by=c("Month","Year"))

#Bind into one data frame
nullcorm<-melt(nullcor,measure.vars=c("all"))

#Get upper and lower quantile of null correlation
nullcorq<-dplyr::group_by(nullcorm,Month,Year,variable) %>% dplyr::summarize(Flowers=unique(Flowers),Upper=quantile(value,0.025),Lower=quantile(value,0.975))

#merge with original data
finaldat<-merge(nullcorq,observed)

#get data size for each month

sizeall<-group_by(m.datH,Month,Year) %>% mutate(Billtype=cut(Total_Culmen,breaks=c(0,60),labels=c("all"))) %>% group_by(Month,Year,Billtype) %>% summarize(N=n())

#bind size with observed and null data
finaldat<-merge(finaldat,sizeall)

p<-ggplot(data=finaldat,aes(x=log(Flowers),fill=variable))
p<-p+geom_ribbon(aes(ymin=Lower,ymax=Upper),fill="grey20",alpha=.15)
p<-p 
p<-p+ theme_bw()  + labs(y="Correlaton between Bill and Corolla Length",x="Log Available Resources",shape="Year",y="")

p<-p + scale_y_continuous(breaks=c(-.3,0,.2,.4,.6,.8)) + scale_size_continuous(range=c(2.5,5)) + scale_fill_discrete(guide="none") + geom_smooth(aes(y=value),method="lm",fill="grey60",alpha=.8)  + labs(size="Observations") + geom_point(aes(y=value,shape=as.factor(Year),size=N)) + geom_text(aes(y=value,label=month.abb[Month]),size=3.5,vjust=-.5)
print(p)
ggsave("Figures/TraitMatching_Resource.jpg",height=6,width=8,units="in",dpi=600)
```

* The working hypothesis is that long billed species tend to feed more on mismatched corolla values during periods of high resource abundance. 

```{r}
specmonth<-function(x){

  monthdata<-droplevels(x)

#make interaction matrix
month.interB<-table(monthdata$Hummingbird,monthdata$Iplant_Double)

#What flowers are present
fl.present<-levels(monthdata$Iplant_Double)

sp_total<-dplyr::group_by(full.fl,Iplant_Double,Month,year) %>% filter(Iplant_Double %in% fl.present, Month %in% monthdata$Month & year %in% monthdata$Year)%>% summarize(N_Flowers=sum(Total_Flowers,na.rm=T)) %>% select(N_Flowers)

if(nrow(sp_total)==0){return(NA)}

missp<-colnames(month.interB)[!colnames(month.interB) %in% sp_total$Iplant_Double]

#get average of the month before and after if missing (pretty rare)
if(length(missp)>0){
print(paste("Abundance missing for species:",missp))
sp_missing<-dplyr::group_by(full.fl,Iplant_Double,Month,year) %>% filter(Iplant_Double %in% fl.present, Month %in% c(monthdata$Month+2,monthdata$Month-2,monthdata$Month+1,monthdata$Month,monthdata$Month-1) & year %in% monthdata$Year) %>% filter(Iplant_Double %in% missp)%>% summarize(N_Flowers=sum(Total_Flowers,na.rm=T)) %>% group_by(Iplant_Double) %>% summarize(N_Flowers=mean(N_Flowers)) %>% mutate(Month=unique(monthdata$Month))
sp_total<-rbind_all(list(sp_total,sp_missing))
}

N_Flowers<-sp_total$N_Flowers
names(N_Flowers)<-sp_total$Iplant_Double

#order 
out<-vector()
for (g in 1:length(N_Flowers)){
  ord<-match(names(N_Flowers)[g],colnames(month.interB))
  out[ord]<-N_Flowers[g]
  names(out)[ord]<-names(N_Flowers)[g]
}
spec<-dfun(month.interB,abuns=sample(N_Flowers))
toreturn<-data.frame(Species=names(spec$dprime),Dprime=spec$dprime,Month=unique(monthdata$Month),Year=unique(monthdata$Year))
return(toreturn)
}
```

```{r}
hlist<-list()
for(d in 1:length(sdat)){
  try(hlist[[d]]<-specmonth(sdat[[d]]))
  }

names(hlist)<-names(sdat)
#remove NA rows for today
hlist<-hlist[sapply(hlist,length)==4]
mlist<-melt(hlist,id.vars=c("Month","Year","Species"))

```

```{r,fig.height=9}
#just keep species with atleast six months of data
spkeep<-names(which(table(mlist$Species)>=5))
mlist<-mlist[mlist$Species %in% spkeep,]
#merge with traits
mlistt<-merge(mlist,hum.morph[,colnames(hum.morph) %in% c("Mass","Total_Culmen","English")],by.x="Species",by.y="English")

mlistt$BillT<-cut(mlistt$Total_Culmen,c(0,30,70),c("Short","Long"))
```

Corolla matching versus all available resources.

```{r,fig.height=9}
#match the trait and bill data with available flowers
h2flowers<-merge(mlistt,flowerMean)

h2match<-merge(m.datH,h2flowers,by.y=c("Month","Year","Species"),by.x=c("Month","Year","Hummingbird"))

#merge with original network measures
nm<-dcast(network.fl,Month+Year~Metric,value.var="True")
h2final<-merge(h2match,nm)

p<-ggplot(h2final[!h2final$Iplant_Double %in% "Fuchsia macrostigma",],aes(x=log(Flowers),y=Total_Culmen.x-TotalCorolla,col=BillT)) + geom_smooth(method="lm") + geom_point() + geom_text(aes(label=paste(Species,Iplant_Double)),size=2)
p<-p + theme_bw()

```

Corolla matching versus species specific available resources. Why should species care if there are a ton of gasternathus flowers in bloom if they never use that resource? Resource scarcity may be different for each species, not synchronized.

```{r,fig.height=10}
#for each species get the list of resources.
keep<-names(which(table(m.datH$Hummingbird) > 30))

hum<-levels(m.datH$Hummingbird)
hum<-hum[hum %in% keep]
flowerh<-lapply(hum,function(h){
  #Find plant species
  plants<-m.datH %>% filter(Hummingbird==h) %>% select(Iplant_Double) %>% distinct()
  
  #Query the transect for availability of these plants
  full.fl %>% filter(Iplant_Double %in% levels(factor(plants$Iplant_Double))) %>% group_by(Month,Year,Transect_R,Date_F) %>% dplyr::summarise(Flowers=sum(Total_Flowers,na.rm=TRUE))  %>% filter(Flowers>2) %>% mutate(Hummingbird=h) %>% group_by(Month,Year,Transect_R,Hummingbird) %>% summarize(TFlowers=mean(Flowers,na.rm=T)) %>% filter(TFlowers>10)
  })
flowerh<-droplevels(rbind_all(flowerh))

#sum by transects
flowerh<-flowerh %>% group_by(Month,Year,Transect_R,Hummingbird) %>% summarize(TF=mean(TFlowers)) %>% group_by(Month,Year,Hummingbird) %>% summarize(Flowers=sum(TF))

ggplot(flowerh,aes(y=log(Flowers),x=Month,shape=as.factor(Year),fill=Hummingbird),alpha=.1) + geom_smooth(aes(group=Hummingbird)) + geom_point(size=2) + theme_bw() + scale_x_continuous(breaks=1:12,labels=month.abb) + ylab("Available Resources")

idflower<-merge(m.datH,flowerh,by=c("Month","Year","Hummingbird"))

#Get the 75% quantile for each species
th<-idflower %>% group_by(Hummingbird) %>% summarize(Threshold=quantile(log(Flowers),0.5))

idflower<-merge(idflower,th)
idflower$HL<-log(idflower$Flowers) > idflower$Threshold

#reorder species levels
ord<-idflower %>% group_by(Hummingbird) %>% summarize(BL=unique(Total_Culmen)) %>% arrange(BL)
idflower$Hummingbird <- factor(idflower$Hummingbird,levels=ord$Hummingbird)

p<-ggplot(idflower,aes(y=Total_Culmen-TotalCorolla,x=HL,fill=Total_Culmen>30)) + geom_boxplot()
p<-p + theme_bw() + facet_wrap(~Hummingbird,scales="free")
p + scale_x_discrete("Available Resources",labels=c("Low","High")) + scale_fill_discrete("Bill Length",labels=c("Short","Long"))

```

#Results
* How many plant records?
* How many bird records?
* How many interactions?

#Discussion

##Comparable literature
* Correa, S., & Winemiller, K. (2014). Niche partitioning among frugivorous fishes in response to fluctuating resources in the Amazonian floodplain forest. Ecology, 95(1), 210–224.

  * In general, dietary shifts in response to changes in the availability of preferred foods reduced interspecific niche overlap and may be a mechanism that facilitates coexistence in this species-rich fish assem- blage. During the period of greatest fruit production, diets of all six species were dominated, to varying degrees, by fruits and seeds, yielding broadly overlap- ping trophic niches among species.
  
* Trait packing, coexsitance and tropical specialization
  * This niche partitioning mechanism is central to many explanations of the latitudinal gradient in species diversity, i.e that greater resources lead to finer subdivision of niche space, and promotes reproductive isolation. 
  
* In this paper we have avoided abundance weighted measures of specialization (see Schluening and Bluthgen) due to the ongoing confusion in this literature. Specialization seems often defined as the fidelity of interactions with respect the abundance of the partners. Quantatitive approachs to network specialization (see H2') only consider 
  * Dalsgaard, B., Magård, E., Fjeldså, J., Martín González, A. M., Rahbek, C., Olesen, J. M., … Svenning, J.-C. (2011). Specialization in plant-hummingbird networks is associated with species richness, contemporary precipitation and quaternary climate-change velocity. PloS One, 6(10), e25891. doi:10.1371/journal.pone.0025891
    * Historical effect on specialization.
